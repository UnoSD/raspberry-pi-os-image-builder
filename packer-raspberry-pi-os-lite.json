{
  "variables": {
    "wifi_ssid": "",
    "wifi_password": "",
    "ssh_public_key_path": null,
    "username": null
  },
  "sensitive-variables": ["wifi_password"],
  "builders": [
    {
      "type": "arm-image",
      "iso_url": "https://downloads.raspberrypi.org/raspios_lite_armhf/images/raspios_lite_armhf-2022-09-26/2022-09-22-raspios-bullseye-armhf-lite.img.xz",
      "iso_checksum": "sha256:9bf5234efbadd2d39769486e0a20923d8526a45eba57f74cda45ef78e2b628da"
    }
  ],
  "provisioners": [
    {
      "type": "shell",
      "inline": [
        "wpa_passphrase \"{{user `wifi_ssid`}}\" \"{{user `wifi_password`}}\" | sed -e 's/#.*$//' -e '/^$/d' >> /etc/wpa_supplicant/wpa_supplicant.conf"
      ]
    },
    {
      "type": "shell",
      "script": "./scripts/run.sh {{user `username`}}"
    },
    {
      "type": "file",
      "source": "{{user `ssh_public_key_path`}}",
      "destination": "/home/{{user `username`}}/.ssh/authorized_keys"
    }
  ]
}
