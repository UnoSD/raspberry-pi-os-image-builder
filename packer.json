{
  "variables": {
    "image_url": null,
    "image_checksum": null,
    "wpa_supplicant_path": "",
    "ip": "",
    "subnet": "",
    "router": "",
    "ssh_public_key_path": null,
    "username": null
  },
  "builders": [
    {
      "type": "arm-image",
      "iso_url": "{{user `image_url`}}",
      "iso_checksum": "{{user `image_checksum`}}"
    }
  ],
  "provisioners": [
    {
      "type": "shell",
      "environment_vars": [ 
        "USERNAME={{user `username`}}",
        "IP={{user `ip`}}",
        "SUBNET={{user `subnet`}}",
        "ROUTER={{user `router`}}"
     ],
      "script": "./setup.sh"
    },
    {
      "type": "file",
      "source": "{{user `ssh_public_key_path`}}",
      "destination": "/home/{{user `username`}}/.ssh/authorized_keys"
    },
    {
        "type": "file",
        "source": "{{user `wpa_supplicant_path`}}",
        "destination": "/etc/wpa_supplicant/wpa_supplicant.conf"
    },
    {
        "type": "shell",
        "inline": [ "chown {{user `username`}}:{{user `username`}} /home/{{user `username`}}/.ssh/authorized_keys" ]
    }
  ]
}
